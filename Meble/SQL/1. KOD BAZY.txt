
-- Tabela "Magazyny" przechowuje informacje o magazynach
CREATE TABLE stores (
    store_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    store_name VARCHAR(100) NOT NULL,
    store_address VARCHAR(200) NOT NULL,
    store_phone VARCHAR(20) NOT NULL,
	store_date_of_update DATETIME DEFAULT GETDATE()
);

-- Tabela "Producenci" przechowuje informacje o producentach mebli
CREATE TABLE manufacturers (
    manufacturer_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    manufacturer_company_name VARCHAR(100) NOT NULL,
    manufacturer_address VARCHAR(200) NOT NULL,
    manufacturer_phone VARCHAR(20) NOT NULL,
    manufacturer_mail VARCHAR(100) NOT NULL,
	manufacture_date_of_update DATETIME DEFAULT GETDATE()
);

-- Tabela "Meble" przechowuje informacje o meblach
CREATE TABLE furnitures ( 
    furniture_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    furniture_name VARCHAR(100) NOT NULL,
    furniture_price DECIMAL(10, 2) NOT NULL CHECK (furniture_price > 0),
    furniture_date_of_addition DATE CHECK(furniture_date_of_addition <= GETDATE()),
    furniture_description VARCHAR(500),
    furniture_manufacturer_id INT NOT NULL,
    furniture_store_id INT NOT NULL,
    furniture_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (furniture_manufacturer_id) REFERENCES manufacturers(manufacturer_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (furniture_store_id) REFERENCES stores(store_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Osoby" przechowuje podstawowe informacje o użytkownikach, pracownikach i dostawcach
CREATE TABLE persons (
    person_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    person_first_name VARCHAR(100) NOT NULL,
    person_surname VARCHAR(100) NOT NULL,
    person_address VARCHAR(200) NOT NULL,
    person_phone VARCHAR(20) NOT NULL,
    person_mail VARCHAR(100) NOT NULL,
    person_date_of_update DATETIME DEFAULT GETDATE()
);

-- Tabela "Użytkownicy" przechowuje informacje specyficzne dla użytkowników
CREATE TABLE users (
    user_primary_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    user_login VARCHAR(50) UNIQUE NOT NULL,
    user_password VARCHAR(64) NOT NULL,
    user_date_of_update DATETIME DEFAULT GETDATE(),
    user_is_employee BIT,
	user_is_supplier BIT,
    user_person_id INT NOT NULL,
    FOREIGN KEY (user_person_id) REFERENCES persons(person_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Dostawcy" przechowuje informacje o dostawcach
CREATE TABLE suppliers (
    supplier_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    supplier_person_id INT NOT NULL,
    supplier_company_name VARCHAR(100) NOT NULL,
    supplier_company_address VARCHAR(200) NOT NULL,
    supplier_company_phone VARCHAR(20) NOT NULL,
    supplier_company_mail VARCHAR(100) NOT NULL,
	supplier_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (supplier_person_id) REFERENCES persons(person_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Zamówienia Dostawców" przechowuje informacje o zamówieniach od dostawców
CREATE TABLE supplier_orders (
    supplier_order_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    supplier_order_supplier_id INT NOT NULL,
    supplier_order_furniture_id INT NOT NULL,
    supplier_order_date_of_order DATE,
    supplier_order_quantity INT NOT NULL CHECK (supplier_order_quantity > 0),
    supplier_order_unit_price DECIMAL(10, 2) NOT NULL CHECK (supplier_order_unit_price > 0),
	supplier_order_date_of_update DATETIME DEFAULT GETDATE(),
	FOREIGN KEY (supplier_order_supplier_id) REFERENCES suppliers(supplier_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (supplier_order_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Zamówienia Klientów" przechowuje informacje o zamówieniach od klientów
CREATE TABLE client_orders (
    client_order_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    client_order_person_id INT NOT NULL,
    client_order_furniture_id INT NOT NULL,
    client_order_date_of_order DATE,
    client_order_quantity INT NOT NULL,
    client_order_unit_price DECIMAL(10, 2) NOT NULL,
	client_order_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (client_order_person_id) REFERENCES persons(person_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (client_order_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Pracownicy" przechowuje informacje o pracownikach
CREATE TABLE employees (
    employee_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    employee_date_of_enployment DATE NOT NULL,
    employee_position VARCHAR(100) NOT NULL,
    employee_store_id INT NOT NULL,
    employee_person_id INT NOT NULL,
    FOREIGN KEY (employee_store_id) REFERENCES stores(store_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (employee_person_id) REFERENCES persons(person_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Zadania" przechowuje informacje o zadaniach dla pracowników
CREATE TABLE tasks (
    task_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    task_employee_id INT NOT NULL,
    task_description VARCHAR(500) NOT NULL,
    task_assignment_date DATE NOT NULL,
	task_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (task_employee_id) REFERENCES employees(employee_id) ON DELETE CASCADE ON UPDATE CASCADE
);


-- Tabela "Kategorie Mebli" przechowuje informacje o kategoriach mebli
CREATE TABLE furniture_categories ( 
    furniture_category_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    furniture_category_name NVARCHAR(50) NOT NULL,
	furniture_category_furniture_id INT NOT NULL,
	furniture_category_date_of_update DATETIME DEFAULT GETDATE(),
	FOREIGN KEY (furniture_category_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Stany Magazynowe" przechowuje informacje o aktualnych stanach magazynowych mebli
CREATE TABLE store_levels (
    store_level_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    store_level_furniture_id INT NOT NULL,
    store_level_store_id INT NOT NULL,
    store_level INT,
	store_level_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (store_level_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE NO ACTION ON UPDATE NO ACTION,
    FOREIGN KEY (store_level_store_id) REFERENCES stores(store_id) ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Tabela "Opinie o Meblach" przechowuje opinie klientów i recenzje ekspertów na temat mebli
CREATE TABLE furniture_opinions (
    furniture_opinion_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    furniture_opinion_furniture_id INT NOT NULL,
    furniture_opinion_rating INT NOT NULL CHECK (furniture_opinion_rating >= 1 AND furniture_opinion_rating <= 10),
    furniture_opinion_user_primary_id INT, 
    furniture_opinion_comment NVARCHAR(500),
    furniture_opinion_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (furniture_opinion_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (furniture_opinion_user_primary_id) REFERENCES users(user_primary_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Rabaty" przechowuje informacje o dostępnych rabatach na meble
CREATE TABLE discounts (
    discount_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    discount_name NVARCHAR(50) NOT NULL,
    discount_percentage_value DECIMAL(5, 2) NOT NULL,
    discount_start_date DATE NOT NULL,
    discount_end_date DATE NOT NULL,
	discount_user_primary_id INT NOT NULL,
	discount_date_of_update DATETIME DEFAULT GETDATE(),
	FOREIGN KEY (discount_user_primary_id) REFERENCES users(user_primary_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tabela "Zdjecia Mebli" przechowuje informacje o zdjęciach mebli
CREATE TABLE photos (
    photo_id INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    photo_furniture_id INT NOT NULL,
    photo_photo VARBINARY(MAX) NOT NULL,
    photo_description NVARCHAR(200) NOT NULL,
	photo_date_of_update DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (photo_furniture_id) REFERENCES furnitures(furniture_id) ON DELETE CASCADE ON UPDATE CASCADE
);
